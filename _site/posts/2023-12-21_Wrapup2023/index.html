<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="William Becker">
<meta name="dcterms.date" content="2023-12-31">

<title>William Becker - 2023 Wrap Up</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">William Becker</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bluefoxr/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/webecker/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">2023 Wrap Up</h1>
            <p class="subtitle lead"></p><p>Looking back on a very busy and interesting year.</p><p></p>
                                <div class="quarto-categories">
                <div class="quarto-category">Meta</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>William Becker </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 31, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="featured.jpg" class="img-fluid"></p>
<p>So it’s the end of 2023, I’ve closed all the big projects that needed closing before Christmas, and thought that a little summary of the year was in order.</p>
<p>2023 was a very busy but also very interesting year for me. As usual in freelance mode, things go up and down quite a lot: the start of the year was fairly manageable, June and July were crazy-busy, the summer was a nice break but I paid for that dearly in September until the end of November period in which a lot of big projects needed finishing at the same time and I nearly melted! Now at the end of December I’m feeling pretty relaxed and everything is fine. Which is why I finally have some time to write something here.</p>
<p>So, looking back on the year, here is how it went.</p>
<section id="ghg-emissions-analysis" class="level2">
<h2 class="anchored" data-anchor-id="ghg-emissions-analysis">GHG Emissions Analysis</h2>
<p>Things kicked off in early January when I started working half-time as a data scientist at the European Commission’s <a href="https://commission.europa.eu/about-european-commission/departments-and-executive-agencies/joint-research-centre_en">Joint Research Centre</a> (JRC), in the <a href="https://edgar.jrc.ec.europa.eu/">EDGAR</a> group which produces and manages a global database on greenhouse gas (GHG) emissions. Although I’d previously worked in the JRC for quite a few years, this was a completely new topic and it took me a while to find my feet and learn all about different GHG emissions, how they are estimated, and the technical ins and outs of the database. After this burn-in period however, and some sharpening my SQL skills, I managed to produce a custom R package and app which allows uncertainty estimation of GHG emissions across any sector, country, substance and time point. Here’s a little snapshot of the uncertainty estimations:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="GHG_totals_top_emitters_with_unc.png" class="img-fluid figure-img"></p>
<figcaption>Total GHG emissions for top emitters</figcaption>
</figure>
</div>
<p>It looks quite straightforward but a lot of work went into it!</p>
<p>Anyway my JRC EDGAR work has been the stable half of my work for the whole of 2023 and I’m glad to say I will be continuing with the group well into 2024.</p>
</section>
<section id="community-based-protection-tool-for-unhcr" class="level2">
<h2 class="anchored" data-anchor-id="community-based-protection-tool-for-unhcr">Community-based protection tool for UNHCR</h2>
<p>Another big project that has run through 2023 is building the <a href="https://github.com/UNHCR-Guatemala/A2SIT">A2SIT app</a> for <a href="https://www.unhcr.org/">UNHCR</a> Guatemala. This started in January when I was contracted to begin work building the back-end code to build a composite indicator to understand which municipalities were most in need of community-based protection in Guatemala. The UNHCR team were in the process of collecting indicators and data, and I helped them build the composite indicator and the data pipeline to calculate index scores, using as usual the <a href="https://bluefoxr.github.io/COINr/">COINr package</a>. At the end of the initial contract, I also floated the idea that I could build the front end of the app using <a href="https://shiny.posit.co/">Shiny</a>, and this led to more work with them, and now I’m very proud to say the A2SIT app is deployed and has been presented to UNHCR offices in various countries as a general tool for measuring “severity”. I’m just wrapping up what will probably be my last contributions to the project as it is pretty much finished, but to give some highlights:</p>
<ul>
<li>The app is built in Shiny using Shinydashboardplus</li>
<li>It takes a custom set of indicators and data uploaded in an Excel file</li>
<li>It builds a composite indicator of severity, returning results and statistics</li>
<li>Results are plotted on interactive maps</li>
<li>Profiles are generated for all regions</li>
<li>Users can upload their own shape files to build composite indicators for any set of regions or countries</li>
<li>The app is fully documented in an <a href="https://unhcr-guatemala.github.io/A2SIT/book/index.html">online book</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="A2SIT_screenshot.png" class="img-fluid figure-img"></p>
<figcaption>Screenshot of A2SIt app</figcaption>
</figure>
</div>
<p>Read some more about the A2SIT app and project in a <a href="https://medium.com/unhcr-innovation-service/everything-all-at-the-same-time-6f554c74f586">Medium article here</a>.</p>
</section>
<section id="a-composite-indicator-app" class="level2">
<h2 class="anchored" data-anchor-id="a-composite-indicator-app">A Composite Indicator App</h2>
<p>Early in 2023 I began working with the <a href="https://www.finddx.org/">Foundation for Innovative New Diagnostics</a> (FIND) to build an app which can build composite indicators for any set of indicators and countries/regions/units. After much hard work through 2023 with a number of talented people, we have deployed a <a href="https://shiny.posit.co/">Shiny</a> app which is being trialled within FIND to help prioritise resources to promote medical diagnosis in developing countries. The app should soon also be released as an open-source R package.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="findapp_screenshot.png" class="img-fluid figure-img"></p>
<figcaption>Screenshot of “Composer” app</figcaption>
</figure>
</div>
<p>The app (working name “Composer”) is effectively an accessible front end for the COINr package, including options for imputation of missing data, outlier treatment, normalisation, aggregation and global sensitivity analysis, not to mention various visualisations in maps, bar and bubble charts. Hopefully some more news on the open source version soon!</p>
</section>
<section id="quality-infrastructure-for-sustainable-development" class="level2">
<h2 class="anchored" data-anchor-id="quality-infrastructure-for-sustainable-development">Quality Infrastructure for Sustainable Development</h2>
<p>Continuing my work with the <a href="https://www.unido.org/">United Nations Industrial Development Organisation</a> (UNIDO), I began working on the update to the <a href="https://hub.unido.org/qi4sd/">Quality Infrastructure for Sustainable Development (QI4SD) Index</a> which I helped to create in 2020. The index, which has attracted some interest around the world and has been adopted by a number of countries as a national performance indicator, should have a full update in 2024.</p>
<p>To bring in as much expert feedback as possible for the update of the index, I worked with UNIDO colleagues to organise two expert workshops: <a href="https://www.willbecker.me/post/2023-10-10_ksa_workshop/">one in Riyadh, Saudia Arabia</a>; and <a href="https://www.willbecker.me/post/2023-11-10_vienna_workshop/">the other in Vienna</a>; in which we presented in detail the index methodology and discussed ways in which it can be improved.</p>
<p>The QI4SD Index should be released again in late 2024.</p>
</section>
<section id="global-innovation-index" class="level2">
<h2 class="anchored" data-anchor-id="global-innovation-index">Global Innovation Index</h2>
<p>In 2023 I continued an excellent collaboration with colleagues and friends in the <a href="https://www.wipo.int/portal/en/index.html">World Intellectual Property Organisation</a> (WIPO) working on the <a href="https://www.wipo.int/global_innovation_index/en/">Global Innovation Index</a> (GII). As part of an innovative team, I have helped redesign the back end of the GII, wrapping the modelling in a custom R package and contributing to documentation, data collection and auditing.</p>
<p>I’m always pround to be part of the GII, which remains one of the highest-quality composite indicators that I have been involved with (and I have worked on many!), from the data collection, processing and auditing, up to the exploration and messaging of the results.</p>
</section>
<section id="european-skills-metrics" class="level2">
<h2 class="anchored" data-anchor-id="european-skills-metrics">European Skills Metrics</h2>
<p>I was proud to be part of a winning consortium in a bid to update and maintain the <a href="https://www.cedefop.europa.eu/en/tools/european-skills-index">European Skills Index</a> (ESI) for <a href="https://www.cedefop.europa.eu/en">Cedefop</a>, a European agency which supports development of European vocational education and training policies and contributes to their implementation.</p>
<p>Working with the <a href="https://www.fondazionebrodolini.it/">Fondazione Brodolini</a>, an Italian consultancy, we have moved the calculation of the ESI to a fully-reproducible programmatic back end based around the <a href="https://bluefoxr.github.io/COINr/">COINr package</a>. All data has now been collected and we expect to release the updated results in early 2024.</p>
</section>
<section id="other-things" class="level2">
<h2 class="anchored" data-anchor-id="other-things">Other things</h2>
<p>Even more things I worked on this year!</p>
<ul>
<li>I was commissioned to write a study by the European Commission on the prevalence of sensitivity analysis in <a href="https://commission.europa.eu/law/law-making-process/planning-and-proposing-law/impact-assessments_en">impact assessments</a></li>
<li>I ran the back-end modelling for the <a href="https://wefnexusindex.org/">Water-Energy-Food Nexus Index</a>, as I have done annually since 2019</li>
<li>I audited the <a href="https://vietnamnews.vn/opinion/1479577/viet-nam-takes-local-approach-to-innovation-based-growth.html">Vietnam Provincial Innovation Index</a>, and was very pleased to meet the talented staff behind its creation near my home in Ispra, Italy!</li>
<li>I made many further updates to the <a href="https://bluefoxr.github.io/COINr/">COINr package</a> to which I have now made <a href="https://github.com/bluefoxr/COINr/commits/master/">over 900 commits</a></li>
</ul>
<p>Finally I’m pleased to say that I have become an <a href="https://www.technopolis-group.com/expert/william-becker/">associate consultant</a> at <a href="https://www.technopolis-group.com/">Technopolis Group</a>, a consultancy that works extensively in European policy in Brussels (and also with many offices worldwide). Very happy to be on board and to be working on projects in the new future!</p>
</section>
<section id="and-so" class="level2">
<h2 class="anchored" data-anchor-id="and-so">And so…</h2>
<p>And so. This has been a really busy but very rewarding year. Although I have been through some very busy periods I’ve had my time off and overall I think it has balanced out quite nicely.</p>
<p>I’m extremely happy to have worked on so many interesting projects, with so many inspiring people. Here’s to another good year in 2024!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, William Becker</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>